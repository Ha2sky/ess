<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë¶€ì„œì› ì¼ê·¼íƒœ ìŠ¹ì¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    .table-container {
        border: 1px solid #d1d5db;
        border-radius: 4px;
    }
    .table-header {
        background-color: #f3f4f6;
        border-bottom: 1px solid #d1d5db;
    }
    .table-row:hover {
        background-color: #f8fafc;
    }
    .table-row.selected {
        background-color: #dbeafe !important;
    }
    .status-waiting {
        background-color: #fef3c7;
        color: #92400e;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
    }
    .status-approved {
        background-color: #d1fae5;
        color: #065f46;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
    }
    .status-rejected {
        background-color: #fee2e2;
        color: #991b1b;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
    }
    .detail-section {
        border: 1px solid #d1d5db;
        border-radius: 4px;
        background-color: #f9fafb;
    }
    .tab-content {
        min-height: 400px;
    }
  </style>
</head>
<body class="bg-white">

<div class="max-w-full mx-auto p-4">
  <!-- í—¤ë” -->
  <div class="mb-4">
    <h1 class="text-xl font-bold text-gray-800">ë¶€ì„œì› ì¼ê·¼íƒœ ìŠ¹ì¸</h1>
    <div class="text-xs text-gray-500 mt-1">
      <span>ğŸ  ê·¼íƒœ / ì¼ ê·¼íƒœ ìŠ¹ì¸ / ë¶€ì„œì› ì¼ê·¼íƒœ ìŠ¹ì¸</span>
    </div>
  </div>

  <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
  <div th:if="${errorMessage}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    <span th:text="${errorMessage}"></span>
  </div>

  <div class="grid grid-cols-12 gap-4">
    <!-- ì¢Œì¸¡ ì˜ì—­ (ê²€ìƒ‰ ì¡°ê±´ + ë¬¸ì„œ ëª©ë¡) -->
    <div class="col-span-8">
      <!-- ê²€ìƒ‰ ì¡°ê±´ -->
      <div class="bg-gray-50 p-3 border border-gray-300 rounded mb-4">
        <!-- ê²€ìƒ‰ í¼ì— í˜„ì¬ í™œì„± íƒ­ ì •ë³´ í¬í•¨ -->
        <form method="get" th:action="@{/user/approval/}" class="grid grid-cols-8 gap-3 items-end" id="searchForm">
          <!-- í˜„ì¬ í™œì„± íƒ­ì„ hidden í•„ë“œë¡œ ìœ ì§€ -->
          <input type="hidden" name="activeTab" id="activeTabInput" th:value="${activeTab}">

          <div class="col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">ëŒ€ìƒì¼ì</label>
            <div class="flex space-x-1">
              <input type="date" name="startDate" th:value="${startDate}"
                     class="w-full text-xs border border-gray-300 rounded px-2 py-1">
              <span class="text-gray-500">~</span>
              <input type="date" name="endDate" th:value="${endDate}"
                     class="w-full text-xs border border-gray-300 rounded px-2 py-1">
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ë²ˆ</label>
            <input type="text" name="empCode" th:value="${empCode}" placeholder="Search..."
                   class="w-full text-xs border border-gray-300 rounded px-2 py-1">
          </div>
          <!-- ê·¼íƒœìœ í˜• ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ë³€ê²½ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ê·¼íƒœìœ í˜•</label>
            <select name="applyType" class="w-full text-xs border border-gray-300 rounded px-2 py-1">
              <option value="">ì „ì²´</option>
              <option value="ì¼ë°˜ê·¼íƒœ" th:selected="${applyType == 'ì¼ë°˜ê·¼íƒœ'}">ì¼ë°˜ê·¼íƒœ</option>
              <option value="ê¸°íƒ€ê·¼íƒœ" th:selected="${applyType == 'ê¸°íƒ€ê·¼íƒœ'}">ê¸°íƒ€ê·¼íƒœ</option>
            </select>
          </div>
          <div>
            <button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded text-sm hover:bg-blue-600">
              ì¡°íšŒ
            </button>
          </div>
          <div class="col-span-3 text-right">
            <button type="button" id="bulkApproveBtn" class="bg-green-500 text-white px-3 py-1 rounded text-xs mr-1">
              ì¼ê´„ìŠ¹ì¸
            </button>
            <button type="button" id="bulkRejectBtn" class="bg-red-500 text-white px-3 py-1 rounded text-xs">
              ì¼ê´„ë°˜ë ¤
            </button>
          </div>
        </form>
      </div>

      <!-- íƒ­ ë©”ë‰´ -->
      <div class="border-b border-gray-200 mb-4">
        <nav class="flex space-x-1">
          <button id="pendingTab" class="tab-button px-4 py-2 text-sm font-medium rounded-t"
                  th:classappend="${activeTab == 'pending' ? 'text-white bg-red-500' : 'text-gray-500 bg-gray-200'}">
            ê²°ì¬í•  ë¬¸ì„œ (<span th:text="${#lists.size(pendingGenerals) + #lists.size(pendingEtcs)}">0</span>)
          </button>
          <button id="approvedTab" class="tab-button px-4 py-2 text-sm font-medium rounded-t"
                  th:classappend="${activeTab == 'approved' ? 'text-white bg-blue-500' : 'text-gray-500 bg-gray-200'}">
            ìŠ¹ì¸ëœ ë¬¸ì„œ (<span th:text="${#lists.size(approvedGenerals) + #lists.size(approvedEtcs)}">0</span>)
          </button>
          <button id="rejectedTab" class="tab-button px-4 py-2 text-sm font-medium rounded-t"
                  th:classappend="${activeTab == 'rejected' ? 'text-white bg-green-500' : 'text-gray-500 bg-gray-200'}">
            ë°˜ë ¤ëœ ë¬¸ì„œ (<span th:text="${#lists.size(rejectedGenerals) + #lists.size(rejectedEtcs)}">0</span>)
          </button>
        </nav>
      </div>

      <!-- ë¬¸ì„œ ëª©ë¡ í…Œì´ë¸” -->
      <div class="table-container tab-content">
        <!-- ê²°ì¬í•  ë¬¸ì„œ -->
        <div id="pendingPanel" class="document-panel" th:style="${activeTab == 'pending' ? 'display: block;' : 'display: none;'}">
          <table class="w-full text-xs">
            <thead class="table-header">
            <tr>
              <th class="px-2 py-2 text-center">
                <input type="checkbox" id="selectAll" class="rounded">
              </th>
              <th class="px-2 py-2 text-center">ê²°ì¬ë²ˆí˜¸</th>
              <th class="px-2 py-2 text-center">ì‹ ì²­ìë²ˆ</th>
              <th class="px-2 py-2 text-center">ìƒì‹ ì</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒìë¶€ì„œ</th>
              <th class="px-2 py-2 text-center">ì‹ ì²­ê·¼íƒœ</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒì</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒì¼</th>
            </tr>
            </thead>
            <tbody>
            <!-- ì¼ë°˜ê·¼íƒœ -->
            <tr th:each="item : ${pendingGenerals}" class="table-row cursor-pointer"
                th:data-type="general" th:data-no="${item.applyGeneralNo}">
              <td class="px-2 py-2 text-center">
                <input type="checkbox" class="document-checkbox rounded" th:value="${item.applyGeneralNo}" data-type="general">
              </td>
              <td class="px-2 py-2 text-center" th:text="${item.applyGeneralNo}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empCode}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applicantName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.deptName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applyType}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.targetDate}"></td>
            </tr>
            <!-- ê¸°íƒ€ê·¼íƒœ -->
            <tr th:each="item : ${pendingEtcs}" class="table-row cursor-pointer"
                th:data-type="etc" th:data-no="${item.applyEtcNo}">
              <td class="px-2 py-2 text-center">
                <input type="checkbox" class="document-checkbox rounded" th:value="${item.applyEtcNo}" data-type="etc">
              </td>
              <td class="px-2 py-2 text-center" th:text="${item.applyEtcNo}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empCode}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applicantName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.deptName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.shiftName != null ? item.shiftName : 'ê¸°íƒ€ê·¼íƒœ'}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.targetStartDate}"></td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- ìŠ¹ì¸ëœ ë¬¸ì„œ -->
        <div id="approvedPanel" class="document-panel" th:style="${activeTab == 'approved' ? 'display: block;' : 'display: none;'}">
          <table class="w-full text-xs">
            <thead class="table-header">
            <tr>
              <th class="px-2 py-2 text-center">ê²°ì¬ë²ˆí˜¸</th>
              <th class="px-2 py-2 text-center">ì‹ ì²­ìë²ˆ</th>
              <th class="px-2 py-2 text-center">ìƒì‹ ì</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒìë¶€ì„œ</th>
              <th class="px-2 py-2 text-center">ì‹ ì²­ê·¼íƒœ</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒì</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒì¼</th>
              <th class="px-2 py-2 text-center">ìƒíƒœ</th>
            </tr>
            </thead>
            <tbody>
            <!-- ì¼ë°˜ê·¼íƒœ ìŠ¹ì¸ ë¬¸ì„œ -->
            <tr th:each="item : ${approvedGenerals}" class="table-row cursor-pointer"
                th:data-type="general" th:data-no="${item.applyGeneralNo}">
              <td class="px-2 py-2 text-center" th:text="${item.applyGeneralNo}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empCode}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applicantName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.deptName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applyType}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.targetDate}"></td>
              <td class="px-2 py-2 text-center">
                <span class="status-approved">ìŠ¹ì¸ì™„ë£Œ</span>
              </td>
            </tr>
            <!-- ê¸°íƒ€ê·¼íƒœ ìŠ¹ì¸ ë¬¸ì„œ -->
            <tr th:each="item : ${approvedEtcs}" class="table-row cursor-pointer"
                th:data-type="etc" th:data-no="${item.applyEtcNo}">
              <td class="px-2 py-2 text-center" th:text="${item.applyEtcNo}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empCode}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applicantName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.deptName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.shiftName != null ? item.shiftName : 'ê¸°íƒ€ê·¼íƒœ'}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.targetStartDate}"></td>
              <td class="px-2 py-2 text-center">
                <span class="status-approved">ìŠ¹ì¸ì™„ë£Œ</span>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- ë°˜ë ¤ëœ ë¬¸ì„œ -->
        <div id="rejectedPanel" class="document-panel" th:style="${activeTab == 'rejected' ? 'display: block;' : 'display: none;'}">
          <table class="w-full text-xs">
            <thead class="table-header">
            <tr>
              <th class="px-2 py-2 text-center">ê²°ì¬ë²ˆí˜¸</th>
              <th class="px-2 py-2 text-center">ì‹ ì²­ìë²ˆ</th>
              <th class="px-2 py-2 text-center">ìƒì‹ ì</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒìë¶€ì„œ</th>
              <th class="px-2 py-2 text-center">ì‹ ì²­ê·¼íƒœ</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒì</th>
              <th class="px-2 py-2 text-center">ëŒ€ìƒì¼</th>
              <th class="px-2 py-2 text-center">ìƒíƒœ</th>
            </tr>
            </thead>
            <tbody>
            <!-- ì¼ë°˜ê·¼íƒœ ë°˜ë ¤ ë¬¸ì„œ -->
            <tr th:each="item : ${rejectedGenerals}" class="table-row cursor-pointer"
                th:data-type="general" th:data-no="${item.applyGeneralNo}">
              <td class="px-2 py-2 text-center" th:text="${item.applyGeneralNo}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empCode}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applicantName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.deptName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applyType}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.targetDate}"></td>
              <td class="px-2 py-2 text-center">
                <span class="status-rejected">ë°˜ë ¤</span>
              </td>
            </tr>
            <!-- ê¸°íƒ€ê·¼íƒœ ë°˜ë ¤ ë¬¸ì„œ -->
            <tr th:each="item : ${rejectedEtcs}" class="table-row cursor-pointer"
                th:data-type="etc" th:data-no="${item.applyEtcNo}">
              <td class="px-2 py-2 text-center" th:text="${item.applyEtcNo}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empCode}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.applicantName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.deptName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.shiftName != null ? item.shiftName : 'ê¸°íƒ€ê·¼íƒœ'}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.empName}"></td>
              <td class="px-2 py-2 text-center" th:text="${item.targetStartDate}"></td>
              <td class="px-2 py-2 text-center">
                <span class="status-rejected">ë°˜ë ¤</span>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ìš°ì¸¡ ì˜ì—­ (ìƒì„¸ ì •ë³´) -->
    <div class="col-span-4">
      <div class="detail-section p-4">
        <h3 class="text-lg font-bold mb-4">ì‹ ì²­ ìƒì„¸</h3>
        <div id="detailContent" class="text-sm">
          <p class="text-gray-500">ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        </div>
      </div>

      <!-- ê²°ì¬ ì²˜ë¦¬ ë²„íŠ¼ -->
      <div class="mt-4 flex space-x-2">
        <button id="approveBtn" class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600 disabled:bg-gray-400" disabled>
          ìŠ¹ì¸
        </button>
        <button id="rejectBtn" class="flex-1 bg-red-500 text-white py-2 rounded hover:bg-red-600 disabled:bg-gray-400" disabled>
          ë°˜ë ¤
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ë°˜ë ¤ ì‚¬ìœ  ëª¨ë‹¬ -->
<div id="rejectModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
  <div class="flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
      <h3 class="text-lg font-bold mb-4">ë°˜ë ¤ ì‚¬ìœ </h3>
      <textarea id="rejectReason" class="w-full h-24 border border-gray-300 rounded px-3 py-2 text-sm"
                placeholder="ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <div class="mt-4 flex space-x-2">
        <button id="confirmReject" class="flex-1 bg-red-500 text-white py-2 rounded hover:bg-red-600">
          ë°˜ë ¤
        </button>
        <button id="cancelReject" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
          ì·¨ì†Œ
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
      let selectedRow = null;
      let selectedType = null;
      let selectedNo = null;

      // í˜„ì¬ í™œì„± íƒ­ ì •ë³´ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê¸°
      let currentActiveTab = '[[${activeTab}]]' || 'pending';

      // íƒ­ ì „í™˜ í•¨ìˆ˜ ê°œì„ 
      function switchTab(tabName) {
          $('.tab-button').removeClass('text-white bg-red-500 bg-blue-500 bg-green-500').addClass('text-gray-500 bg-gray-200');
          $('.document-panel').hide();

          currentActiveTab = tabName;
          $('#activeTabInput').val(tabName); // hidden í•„ë“œ ì—…ë°ì´íŠ¸

          if (tabName === 'pending') {
              $('#pendingTab').removeClass('text-gray-500 bg-gray-200').addClass('text-white bg-red-500');
              $('#pendingPanel').show();
              $('#approveBtn, #rejectBtn').prop('disabled', false);
          } else if (tabName === 'approved') {
              $('#approvedTab').removeClass('text-gray-500 bg-gray-200').addClass('text-white bg-blue-500');
              $('#approvedPanel').show();
              $('#approveBtn, #rejectBtn').prop('disabled', true);
          } else if (tabName === 'rejected') {
              $('#rejectedTab').removeClass('text-gray-500 bg-gray-200').addClass('text-white bg-green-500');
              $('#rejectedPanel').show();
              $('#approveBtn, #rejectBtn').prop('disabled', true);
          }

          // ì„ íƒ ì´ˆê¸°í™”
          selectedRow = null;
          selectedType = null;
          selectedNo = null;
          $('#detailContent').html('<p class="text-gray-500">ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>');
      }

      // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
      $('.tab-button').click(function() {
          const tabId = this.id;
          if (tabId === 'pendingTab') {
              switchTab('pending');
          } else if (tabId === 'approvedTab') {
              switchTab('approved');
          } else if (tabId === 'rejectedTab') {
              switchTab('rejected');
          }
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ í™œì„± íƒ­ìœ¼ë¡œ ì„¤ì •
      switchTab(currentActiveTab);

      // í–‰ í´ë¦­ ì´ë²¤íŠ¸
      $(document).on('click', '.table-row', function() {
          selectedRow = $(this);
          selectedType = $(this).data('type');
          selectedNo = $(this).data('no');

          $('.table-row').removeClass('selected');
          $(this).addClass('selected');

          loadDetail(selectedType, selectedNo);

          // ê²°ì¬í•  ë¬¸ì„œ íƒ­ì—ì„œë§Œ ë²„íŠ¼ í™œì„±í™”
          if (currentActiveTab === 'pending') {
              $('#approveBtn, #rejectBtn').prop('disabled', false);
          }
      });

      // ìƒì„¸ ì •ë³´ ë¡œë“œ
      function loadDetail(type, no) {
          $.get('/user/approval/detail/' + type + '/' + no)
              .done(function(data) {
                  if (data.error) {
                      $('#detailContent').html('<p class="text-red-500">' + data.error + '</p>');
                      return;
                  }

                  let html = '';
                  if (data.applyInfo) {
                      html += '<div class="mb-4">';
                      html += '<h4 class="font-bold mb-2">ì‹ ì²­ ì •ë³´</h4>';
                      html += '<div class="grid grid-cols-2 gap-2 text-xs">';
                      html += '<div><span class="font-medium">ì‹ ì²­ë²ˆí˜¸:</span> ' + (data.applyInfo.APPLY_GENERAL_NO || data.applyInfo.APPLY_ETC_NO) + '</div>';
                      html += '<div><span class="font-medium">ì‹ ì²­ì¼ì:</span> ' + data.applyInfo.APPLY_DATE + '</div>';

                      // ìˆ˜ì •: ê¸°íƒ€ê·¼íƒœì˜ ê²½ìš° ì‹ ì²­ëŒ€ìƒì¼ ì¶”ê°€
                      if (data.applyInfo.TARGET_DATE) {
                          html += '<div><span class="font-medium">ê·¼ë¬´ì¼:</span> ' + data.applyInfo.TARGET_DATE + '</div>';
                      } else if (data.applyInfo.TARGET_START_DATE) {
                          html += '<div><span class="font-medium">ì‹ ì²­ëŒ€ìƒì¼:</span> ' + data.applyInfo.TARGET_START_DATE;
                          if (data.applyInfo.TARGET_END_DATE && data.applyInfo.TARGET_END_DATE !== data.applyInfo.TARGET_START_DATE) {
                              html += ' ~ ' + data.applyInfo.TARGET_END_DATE;
                          }
                          html += '</div>';
                      }

                      if (data.applyInfo.WORK_TIME_RANGE) {
                          html += '<div><span class="font-medium">ì‹œê°„:</span> ' + data.applyInfo.WORK_TIME_RANGE + '</div>';
                      }

                      // ìˆ˜ì •: ì‹¤ì œ ì‚¬ìœ  í‘œì‹œ (ì¼ë°˜ê·¼íƒœ/ê¸°íƒ€ê·¼íƒœ ëª¨ë‘)
                      if (data.applyInfo.REASON) {
                          html += '<div class="col-span-2"><span class="font-medium">ì‚¬ìœ :</span> ' + data.applyInfo.REASON + '</div>';
                      }
                      html += '</div></div>';
                  }

                  if (data.applicantInfo) {
                      html += '<div class="mb-4">';
                      html += '<h4 class="font-bold mb-2">ìƒì‹ ì ì •ë³´</h4>';
                      html += '<div class="grid grid-cols-2 gap-2 text-xs">';
                      html += '<div><span class="font-medium">ì‚¬ë²ˆ:</span> ' + data.applicantInfo.EMP_CODE + '</div>';
                      html += '<div><span class="font-medium">ì„±ëª…:</span> ' + data.applicantInfo.EMP_NAME + '</div>';
                      html += '<div><span class="font-medium">ë¶€ì„œ:</span> ' + data.applicantInfo.DEPT_NAME + '</div>';
                      html += '<div><span class="font-medium">ì§ì±…:</span> ' + data.applicantInfo.POSITION_NAME + '</div>';
                      html += '</div></div>';
                  }

                  if (data.targetInfo) {
                      html += '<div class="mb-4">';
                      html += '<h4 class="font-bold mb-2">ëŒ€ìƒì ì •ë³´</h4>';
                      html += '<div class="grid grid-cols-2 gap-2 text-xs">';
                      html += '<div><span class="font-medium">ì‚¬ë²ˆ:</span> ' + data.targetInfo.EMP_CODE + '</div>';
                      html += '<div><span class="font-medium">ì„±ëª…:</span> ' + data.targetInfo.EMP_NAME + '</div>';
                      html += '<div><span class="font-medium">ë¶€ì„œ:</span> ' + data.targetInfo.DEPT_NAME + '</div>';
                      html += '<div><span class="font-medium">ì§ì±…:</span> ' + data.targetInfo.POSITION_NAME + '</div>';
                      html += '</div></div>';
                  }

                  // ìˆ˜ì •: ê·¼íƒœê¸° ì •ë³´ ì¶”ê°€ (ëŒ€ìƒì ì •ë³´ì™€ ê²°ì¬ì ì •ë³´ ì‚¬ì´)
                  if (data.attendanceInfo) {
                      html += '<div class="mb-4">';
                      html += '<h4 class="font-bold mb-2">ê·¼íƒœê¸° ì •ë³´</h4>';
                      html += '<div class="text-xs">';
                      html += '<table class="w-full border border-gray-300">';
                      html += '<thead class="bg-gray-100">';
                      html += '<tr>';
                      html += '<th class="border border-gray-300 px-2 py-1">ë‚ ì§œ</th>';
                      html += '<th class="border border-gray-300 px-2 py-1">ì¶œê·¼ì‹œê°„</th>';
                      html += '<th class="border border-gray-300 px-2 py-1">í‡´ê·¼ì‹œê°„</th>';
                      html += '</tr>';
                      html += '</thead>';
                      html += '<tbody>';
                      data.attendanceInfo.forEach(function(attendance) {
                          html += '<tr>';
                          html += '<td class="border border-gray-300 px-2 py-1 text-center">' + attendance.WORK_DATE + '</td>';
                          html += '<td class="border border-gray-300 px-2 py-1 text-center">' + (attendance.CHECK_IN_TIME || '-') + '</td>';
                          html += '<td class="border border-gray-300 px-2 py-1 text-center">' + (attendance.CHECK_OUT_TIME || '-') + '</td>';
                          html += '</tr>';
                      });
                      html += '</tbody>';
                      html += '</table>';
                      html += '</div></div>';
                  }

                  if (data.approvalHistory && data.approvalHistory.length > 0) {
                      html += '<div class="mb-4">';
                      html += '<h4 class="font-bold mb-2">ê²°ì¬ì ì •ë³´</h4>';
                      html += '<div class="text-xs">';
                      html += '<table class="w-full border border-gray-300">';
                      html += '<thead class="bg-gray-100">';
                      html += '<tr>';
                      html += '<th class="border border-gray-300 px-1 py-1">ìˆœë²ˆ</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">êµ¬ë¶„</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">ë¶€ì„œ</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">ì§ì±…</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">ì´ë¦„</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">ì‚¬ë²ˆ</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">ê²°ê³¼</th>';
                      html += '<th class="border border-gray-300 px-1 py-1">ê²°ì¬ì™„ë£Œì¼</th>';
                      html += '</tr>';
                      html += '</thead>';
                      html += '<tbody>';
                      data.approvalHistory.forEach(function(history) {
                          html += '<tr>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.ORDER_NUM || '1') + '</td>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.CATEGORY || 'ë¶€ì„œì¥') + '</td>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.DEPT_NAME || '-') + '</td>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.POSITION_NAME || '-') + '</td>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.APPROVER_NAME || '-') + '</td>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.APPROVER_CODE || '-') + '</td>';
                          // ìˆ˜ì •: ê²°ê³¼ ë¶€ë¶„ undefined ë¬¸ì œ í•´ê²°
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.APPROVAL_STATUS || 'ëŒ€ê¸°') + '</td>';
                          html += '<td class="border border-gray-300 px-1 py-1 text-center">' + (history.APPROVAL_DATE || '-') + '</td>';
                          html += '</tr>';
                      });
                      html += '</tbody>';
                      html += '</table>';
                      html += '</div></div>';
                  }

                  $('#detailContent').html(html);
              })
              .fail(function() {
                  $('#detailContent').html('<p class="text-red-500">ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨</p>');
              });
      }

      // ìŠ¹ì¸ ì²˜ë¦¬ í›„ í˜„ì¬ íƒ­ ìœ ì§€í•˜ë©´ì„œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
      $('#approveBtn').click(function() {
          if (!selectedType || !selectedNo) return;

          $.post('/user/approval/approve/' + selectedType, {
              [selectedType === 'general' ? 'applyGeneralNo' : 'applyEtcNo']: selectedNo
          })
          .done(function(response) {
              if (response === 'success') {
                  alert('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                  // ìŠ¹ì¸ í›„ ìŠ¹ì¸ëœ ë¬¸ì„œ íƒ­ìœ¼ë¡œ ì´ë™í•˜ë©´ì„œ ìƒˆë¡œê³ ì¹¨
                  window.location.href = '/user/approval/?activeTab=approved&startDate=' +
                                       $('input[name="startDate"]').val().replace(/-/g, '') +
                                       '&endDate=' + $('input[name="endDate"]').val().replace(/-/g, '') +
                                       '&empCode=' + $('input[name="empCode"]').val() +
                                       '&applyType=' + $('select[name="applyType"]').val();
              } else {
                  alert(response);
              }
          })
          .fail(function() {
              alert('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          });
      });

      // ë°˜ë ¤ ì²˜ë¦¬
      $('#rejectBtn').click(function() {
          if (!selectedType || !selectedNo) return;
          $('#rejectModal').removeClass('hidden');
      });

      $('#confirmReject').click(function() {
          const reason = $('#rejectReason').val().trim();
          if (!reason) {
              alert('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
              return;
          }

          $.post('/user/approval/reject/' + selectedType, {
              [selectedType === 'general' ? 'applyGeneralNo' : 'applyEtcNo']: selectedNo,
              rejectReason: reason
          })
          .done(function(response) {
              if (response === 'success') {
                  alert('ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.');
                  // ë°˜ë ¤ í›„ ë°˜ë ¤ëœ ë¬¸ì„œ íƒ­ìœ¼ë¡œ ì´ë™í•˜ë©´ì„œ ìƒˆë¡œê³ ì¹¨
                  window.location.href = '/user/approval/?activeTab=rejected&startDate=' +
                                       $('input[name="startDate"]').val().replace(/-/g, '') +
                                       '&endDate=' + $('input[name="endDate"]').val().replace(/-/g, '') +
                                       '&empCode=' + $('input[name="empCode"]').val() +
                                       '&applyType=' + $('select[name="applyType"]').val();
              } else {
                  alert(response);
              }
          })
          .fail(function() {
              alert('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          });

          $('#rejectModal').addClass('hidden');
          $('#rejectReason').val('');
      });

      $('#cancelReject').click(function() {
          $('#rejectModal').addClass('hidden');
          $('#rejectReason').val('');
      });

      // ì „ì²´ ì„ íƒ/í•´ì œ
      $('#selectAll').change(function() {
          $('.document-checkbox:visible').prop('checked', this.checked);
      });

      // ì¼ê´„ ìŠ¹ì¸
      $('#bulkApproveBtn').click(function() {
          const checkedItems = $('.document-checkbox:checked:visible');
          if (checkedItems.length === 0) {
              alert('ìŠ¹ì¸í•  ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
              return;
          }

          if (!confirm('ì„ íƒí•œ ' + checkedItems.length + 'ê±´ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              return;
          }

          let completed = 0;
          let errors = [];

          checkedItems.each(function() {
              const type = $(this).data('type');
              const no = $(this).val();

              $.post('/user/approval/approve/' + type, {
                  [type === 'general' ? 'applyGeneralNo' : 'applyEtcNo']: no
              })
              .done(function(response) {
                  if (response !== 'success') {
                      errors.push(no + ': ' + response);
                  }
              })
              .fail(function() {
                  errors.push(no + ': ì²˜ë¦¬ ì‹¤íŒ¨');
              })
              .always(function() {
                  completed++;
                  if (completed === checkedItems.length) {
                      if (errors.length > 0) {
                          alert('ì¼ë¶€ ë¬¸ì„œ ì²˜ë¦¬ ì‹¤íŒ¨:\n' + errors.join('\n'));
                      } else {
                          alert('ëª¨ë“  ë¬¸ì„œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                      }
                      // ìŠ¹ì¸ëœ ë¬¸ì„œ íƒ­ìœ¼ë¡œ ì´ë™
                      window.location.href = '/user/approval/?activeTab=approved&startDate=' +
                                           $('input[name="startDate"]').val().replace(/-/g, '') +
                                           '&endDate=' + $('input[name="endDate"]').val().replace(/-/g, '') +
                                           '&empCode=' + $('input[name="empCode"]').val() +
                                           '&applyType=' + $('select[name="applyType"]').val();
                  }
              });
          });
      });

      // ì¼ê´„ ë°˜ë ¤
      $('#bulkRejectBtn').click(function() {
          const checkedItems = $('.document-checkbox:checked:visible');
          if (checkedItems.length === 0) {
              alert('ë°˜ë ¤í•  ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
              return;
          }

          const reason = prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
          if (!reason || !reason.trim()) {
              return;
          }

          if (!confirm('ì„ íƒí•œ ' + checkedItems.length + 'ê±´ì„ ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              return;
          }

          let completed = 0;
          let errors = [];

          checkedItems.each(function() {
              const type = $(this).data('type');
              const no = $(this).val();

              $.post('/user/approval/reject/' + type, {
                  [type === 'general' ? 'applyGeneralNo' : 'applyEtcNo']: no,
                  rejectReason: reason.trim()
              })
              .done(function(response) {
                  if (response !== 'success') {
                      errors.push(no + ': ' + response);
                  }
              })
              .fail(function() {
                  errors.push(no + ': ì²˜ë¦¬ ì‹¤íŒ¨');
              })
              .always(function() {
                  completed++;
                  if (completed === checkedItems.length) {
                      if (errors.length > 0) {
                          alert('ì¼ë¶€ ë¬¸ì„œ ì²˜ë¦¬ ì‹¤íŒ¨:\n' + errors.join('\n'));
                      } else {
                          alert('ëª¨ë“  ë¬¸ì„œê°€ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.');
                      }
                      // ë°˜ë ¤ëœ ë¬¸ì„œ íƒ­ìœ¼ë¡œ ì´ë™
                      window.location.href = '/user/approval/?activeTab=rejected&startDate=' +
                                           $('input[name="startDate"]').val().replace(/-/g, '') +
                                           '&endDate=' + $('input[name="endDate"]').val().replace(/-/g, '') +
                                           '&empCode=' + $('input[name="empCode"]').val() +
                                           '&applyType=' + $('select[name="applyType"]').val();
                  }
              });
          });
      });
  });
</script>

</body>
</html>
